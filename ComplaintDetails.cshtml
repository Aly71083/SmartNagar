@model SmartNagar.Models.Complaint
@{
    Layout = "~/Views/Officer/_OfficerLayout.cshtml";
    ViewBag.Title = "Complaint Details";
}

<style>
    .wrap {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 14px;
    }

    .cardx {
        background: #fff;
        border: 1px solid #ece7ff;
        border-radius: 18px;
        box-shadow: 0 12px 35px rgba(16,24,40,.08);
        padding: 16px;
    }

    .title {
        font-size: 24px;
        font-weight: 1000;
        margin: 0;
    }

    .sub {
        color: #667085;
        font-weight: 800;
        margin-top: 6px;
    }

    .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
    }

    .chip {
        padding: 6px 10px;
        border-radius: 999px;
        font-weight: 900;
        font-size: 12px;
        display: inline-block;
        background: #ede9fe;
        color: #6d28d9;
    }

    .tag {
        padding: 6px 10px;
        border-radius: 999px;
        font-weight: 900;
        font-size: 12px;
        display: inline-block;
    }

    .t-pending {
        background: #fee2e2;
        color: #b42318;
    }

    .t-progress {
        background: #dbeafe;
        color: #1d4ed8;
    }

    .t-resolved {
        background: #dcfce7;
        color: #166534;
    }

    .t-rejected {
        background: #f3f4f6;
        color: #374151;
    }

    .lbl {
        color: #667085;
        font-weight: 900;
        font-size: 12px;
        margin-top: 12px;
    }

    .val {
        font-weight: 900;
        margin-top: 6px;
    }

    .btn {
        border: none;
        border-radius: 12px;
        padding: 10px 12px;
        font-weight: 1000;
        cursor: pointer;
    }

    .btnPurple {
        background: #7c3aed;
        color: #fff;
    }

        .btnPurple:hover {
            background: #6d28d9;
        }

    .btnGhost {
        border: 1px solid #ece7ff;
        background: #fff;
        color: #7c3aed;
        text-decoration: none;
        display: inline-block;
    }

    .gallery {
        display: grid;
        grid-template-columns: repeat(3,1fr);
        gap: 10px;
        margin-top: 10px;
    }

    .imgCard {
        border: 1px solid #ece7ff;
        border-radius: 14px;
        overflow: hidden;
        background: #faf7ff;
    }

        .imgCard img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }

    .imgCap {
        padding: 8px 10px;
        font-size: 12px;
        font-weight: 900;
        color: #667085;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
    }

    .smallLink {
        font-weight: 1000;
        color: #7c3aed;
        text-decoration: none;
        white-space: nowrap;
    }

    textarea {
        width: 100%;
        border: 1px solid #ece7ff;
        border-radius: 12px;
        padding: 10px 12px;
        outline: none;
        font-weight: 800;
        min-height: 110px;
        background: #fff;
    }

    select {
        width: 100%;
        border: 1px solid #ece7ff;
        border-radius: 12px;
        padding: 10px 12px;
        outline: none;
        font-weight: 900;
        background: #fff;
    }
</style>

@{
    var s = (Model.Status ?? "Pending").ToLower();
    var cls = s switch
    {
        "pending" => "t-pending",
        "in progress" => "t-progress",
        "resolved" => "t-resolved",
        "rejected" => "t-rejected",
        _ => "t-pending"
    };
}

<div class="wrap">
    <!-- LEFT: DETAILS -->
    <div class="cardx">
        <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
            <div>
                <h2 class="title">CN-@Model.Id.ToString("0000") — @Model.Title</h2>
                <div class="sub">Created: @Model.CreatedAt.ToString("MMM dd, yyyy, hh:mm tt")</div>
            </div>
            <div style="display:flex; align-items:flex-start; gap:10px; flex-wrap:wrap;">
                <span class="chip">@((Model.Category ?? "Other Issues"))</span>
                <span class="tag @cls">@Model.Status</span>
            </div>
        </div>

        <div class="lbl">Description</div>
        <div class="val" style="font-weight:800; color:#101828;">
            @(string.IsNullOrWhiteSpace(Model.Description) ? "No description provided." : Model.Description)
        </div>

        <div class="row">
            <div class="chip">Citizen: @(Model.Citizen?.FullName ?? "Citizen")</div>
            <div class="chip">Email: @(Model.Citizen?.Email ?? "-")</div>
            <div class="chip">Assigned: @(string.IsNullOrWhiteSpace(Model.AssignedOfficerId) ? "No" : "Yes")</div>
        </div>

        <div class="lbl">Uploaded Images</div>

        @if (Model.Photos != null && Model.Photos.Count > 0)
        {
            <div class="gallery">
                @foreach (var p in Model.Photos.OrderByDescending(x => x.UploadedAt))
                {
                    <div class="imgCard">
                        <img src="@p.FilePath" alt="Complaint image" />
                        <div class="imgCap">
                            <span>@(p.OriginalName ?? "Photo")</span>
                            <a class="smallLink" href="@p.FilePath" target="_blank">Open</a>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div style="margin-top:10px; color:#667085; font-weight:800;">
                No images uploaded for this complaint.
            </div>
        }

        <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
            <a class="btn btnGhost" href="/Officer/Complaints">← Back to All Complaints</a>

            @if (string.IsNullOrWhiteSpace(Model.AssignedOfficerId))
            {
                <form asp-action="AssignToMe" method="post" style="display:inline;">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" value="@Model.Id" />
                    <button type="submit" class="btn btnPurple">Assign to me</button>
                </form>
            }
        </div>
    </div>

    <!-- RIGHT: ACTIONS -->
    <div class="cardx">
        <div style="font-weight:1000; font-size:16px;">Officer Actions</div>
        <div class="sub" style="margin-top:6px;">Update status and manage resolution timeline.</div>

        <div class="lbl">Update Status</div>
        <form asp-action="UpdateStatus" method="post" style="margin-top:8px;">
            @Html.AntiForgeryToken()
            <input type="hidden" name="id" value="@Model.Id" />

            <select name="status">
                @{
                    var statuses = new[] { "Pending", "In Progress", "Resolved", "Rejected" };
                }
                @foreach (var st in statuses)
                {
                    <option value="@st" selected="@(Model.Status == st)">@st</option>
                }
            </select>

            <button type="submit" class="btn btnPurple" style="margin-top:10px; width:100%;">Save</button>
        </form>

        <div class="lbl">Timeline</div>
        <div class="val" style="font-weight:800; color:#101828;">
            <div>Created: @Model.CreatedAt.ToString("MMM dd, yyyy")</div>
            <div>Assigned At: @(Model.AssignedAt?.ToLocalTime().ToString("MMM dd, yyyy") ?? "-")</div>
            <div>Resolved At: @(Model.ResolvedAt?.ToString("MMM dd, yyyy") ?? "-")</div>
            <div>Updated At: @(Model.UpdatedAt?.ToLocalTime().ToString("MMM dd, yyyy") ?? "-")</div>
        </div>

        <div style="height:12px;"></div>

        <a class="btn btnGhost" style="width:100%; text-align:center;" href="/Officer/MyAssignments">
            Go to My Assignments
        </a>
    </div>
</div>